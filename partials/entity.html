<script type="text/ng-template" id="section_template.html">

	<li ng-if="!section.value" ng-class="{'thumbnail' : section.contextEntity}">
		<b>{{section.label}}</b>
		<ul ng-repeat="section in (section.content || section.contextEntity)" ng-include="'section_template.html'"></ul>
	</li>

	<li ng-if="section.value" ng-switch="isArray(section.value)">
		<span ng-switch-when="false" ng-bind-html="section.value"></span>
		<div ng-switch-when="true">
			<div class="section-item" ng-repeat="valueItem in section.value" ng-bind-html="valueItem"></div>
		</div>
	</li>

</script>

<div ng-cloak class="row"  ng-controller="EntityCtrl">

	<!-- Fehlermeldungen -->
	<div ng-show="error">
		<div class="row">
			<div class="col-md-10 col-md-offset-1 alert alert-warning text-center">
				<b>Fehler:</b> Anfrage konnte nicht ausgeführt werden.
				Bitte wenden Sie sich an <a href="mailto:arachne@uni-koeln.de">arachne@uni-koeln.de</a>
				sollte dieser Fehler häufiger auftreten.
			</div>
		</div>
	</div>

	<div ng-hide="entity.entityId || error" class="loading"></div>

	<div class="col-md-3" ng-show="entity.entityId">

		<!-- CURRENT QUERY STATUS -->
		<div ng-if="resultSize">

			<h5 ng-if="currentQuery.q" class="text-muted">
				<strong class="uppercase">Aktuelle Suche</strong>
			</h5>

			<div ng-if="currentQuery.q" class="panel panel-default">

				<div class="panel-heading">

					<a ng-href="search/{{currentQuery.removeParam('resultIndex').removeParam('offset').toString()}}"
							class="btn btn-xs pull-right btn-primary">
						<span class="glyphicon glyphicon-arrow-left"></span> zum Suchergebnis
					</a>

					<div>
						<b class="text-muted uppercase small">Suchbegriff</b><br>
						{{currentQuery.q}}
					</div>

					<div ng-if="currentQuery.hasFacets()">
						<b class="text-muted uppercase small">Aktive Filter</b>
						<ul>
							<li ng-repeat="(facetName,facetValue) in currentQuery.facets">
								<small>
									<i>{{facetName | i18n}}</i>
									<b style="text-transform:capitalize;"> &nbsp; {{facetValue}}</b>
								</small>
							</li>
						</ul>
					</div>

				</div>

				<ul class="list-group">

					<a ng-if="prevEntity"
							ng-href="entity/{{prevEntity.entityId}}{{currentQuery.setParam('resultIndex',resultIndex-1).toString()}}"
							class="list-group-item"
							style="height:75px; overflow:hidden">
						<div>
							<b class="text-muted uppercase small">
								<span class="glyphicon glyphicon-chevron-left" style="color:black" ></span>
								&nbsp; vorheriges Ergebnis
							</b>
						</div>
						<div ar-entity-title entity="prevEntity"></div>
						
					</a>

					<li class="list-group-item" ng-hide="nextEntitySearch.size < 2" >
						<b class="text-muted uppercase small">Angezeiger Datensatz</b>
						<form ng-submit="go('/entity/' + currentQuery.setParam('resultIndex',resultIndexInput-1).toString())">
							<div class="input-group"
									ng-class="{'has-error':(resultIndexInput < 1 || resultIndexInput > resultSize)}">
						    	<input ng-model="resultIndexInput"
						    			type="number" size="4"
						    			min="1" max="{{resultSize}}" class="form-control input-sm">
						    	<span class="input-group-addon"><small>von</small> <strong>{{resultSize}}</strong></span>
						    </div>
						</form>
					</li>

					<a ng-if="nextEntity"
							ng-href="entity/{{nextEntity.entityId}}{{currentQuery.setParam('resultIndex',resultIndex+1).toString()}}"
							class="list-group-item text-right"
							style="height:75px; overflow:hidden">
						<div>
							<b class="text-muted uppercase small">
								&nbsp; nächstes Ergebnis
								<span class="glyphicon glyphicon-chevron-right" style="color:black" ></span>
							</b>
						</div>
						<div ar-entity-title entity="nextEntity"></div>
						
					</a>

				</ul>

			</div>

		</div>
		<!-- END CURRENT QUERY STATUS -->

		<!-- NOTES -->
		<div ng-if="user.username" ng-init="queryBookmarListsForEntityId()">
			<h5 class="text-muted uppercase"><strong>Lesezeichen & Notiz</strong></h5>
			<div ng-repeat="bookmarklist in bookmarklists">
				<div ng-repeat="bookmark in bookmarklist.bookmarks" class="panel panel-warning">
					<div class="panel-heading">
						{{ bookmarklist.name }}: 
						<div class="btn-group pull-right">
							<button class="btn btn-sm" ng-click="updateBookmark(bookmark)" data-dismiss="alert" >
								<span class="glyphicon glyphicon-pencil"></span>
							</button>
							<button class="btn btn-sm" ng-click="deleteBookmark(bookmark.id)" class="close" data-dismiss="alert" >
								<span class="glyphicon glyphicon-remove"></span>
							</button>
							
						</div>
					</div>
					<div class="panel-body small">
						{{ bookmark.commentary }}<br>
					</div>
				</div>
			</div>
			<button type="button" class="btn btn-warning btn-sm" ng-click="createBookmark()">
				<span class="glyphicon glyphicon-plus"></span> Notiz als Lesezeichen
			</button>
		</div>
		<!-- END NOTES -->

	</div>

	<div ng-show="entity.entityId" class="col-md-9">

		<div class="row">

			<!-- CONTENT SECTION -->
			<div class="col-md-8">

				<h2>
					{{ entity.title }} <span ng-if="!entity.title" class="capitalized">{{entity.type }}</span><br>
					<small>{{ entity.subtitle }}</small>
				</h2>

				<hr>
				<div class="row">
					<div class="col-md-3">
						<b>Entity-ID:</b><br>{{ entity.entityId }}
					</div>
					<div class="col-md-3">
						<b>Kategorie:</b><br>{{ singular[entity.type] }}
					</div>
					<div class="col-md-3">
						<b>Seriennummer:</b><br>{{ entity.internalId }}
					</div>
					<div class="col-md-3">
						
						<div class="btn-group-vertical pull-right">
							<button style="text-align:left"
									ng-click="permaLink=!permaLink"
									ng-class="{'active':permaLink}"
									class="btn btn-default btn-xs">
								<span class="glyphicon glyphicon-link"></span>
								&nbsp;Perma-Link
							</button>
							<button style="text-align:left"
									ng-show="entity.facet_aufbewahrungsort || entity.facet_fundort"ng-init="karteAnzeigen=false"
									ng-class="{'active':karteAnzeigen}"
									ng-click="karteAnzeigen=!karteAnzeigen" class="btn btn-default btn-xs">
								<span class="glyphicon glyphicon-map-marker"></span> &nbsp;Karte
							</button>
						</div>
					</div>
				</div>
				<div class="row" ng-hide="!permaLink">
					<div class="col-md-12">
						<hr>
						<b>Perma-Link: </b><a href="{{ serverUri }}entity/{{entity.entityId}}">{{ serverUri }}entity/{{entity.entityId}}</a>
					</div>
				</div>	
				<div class="row" ng-if="karteAnzeigen">
					<div class="col-md-12">
						<hr>
						<div ng-if="entity.facet_fundort" entities="[entity]" style="height:300px" locationfacetname="locationfacetname = 'facet_fundort'"  map id="map1"></div>
						<div ng-if="entity.facet_aufbewahrungsort" entities="[entity]" style="height:300px; margin-top:16px" locationfacetname="locationfacetname = 'facet_aufbewahrungsort'" map id="map2"></div>
					</div>
				</div>		  
				<hr>

				<div ng-if="!entity.sections.content">
					<em>keine weiteren Angaben eingetragen</em>
				</div>
				<div class="sections"
						ng-repeat="section in entity.sections.content"
						ng-include="'section_template.html'">
				</div>
				<div ng-if="entity.additionalContent.ocrText">
					<div class="page-header"><h4>OCR Text-Analyse</h4></div>
					<ul>{{entity.additionalContent.ocrText}}</ul>
				</div>

			</div>
			<!-- END CONTENT SECTION -->

			<!-- CONTEXT & IMAGE SECTION -->
			<div class="col-md-4">

				<div class="row">
					<div class="col-md-12">
						<h3 ng-if="entity.images.length > 1">Abbildungen <small>({{entity.images.length}})</small></h3>
						<h3 ng-if="entity.images.length == 1">Abbildung</h3>
						<div ar-imageslider ng-if="entity.images" entity="entity"></div>
					</div>
				</div>

				<div class="row" ng-if="specialNavigations.specialNavigationElements">
					<div class="col-md-12">
						<h3>Andere Ansichten</h3>
						<div class="btn-group">
							<a target="_blank" ng-repeat="navigation in specialNavigations.specialNavigationElements" href="{{ navigation.link }}" type="button" class="btn btn-info btn-sm">{{ navigation.title}} </a>
						</div>
					</div>
				</div>
				
				<div class="row" ng-show="contextSize">
					<div class="col-md-12">
						
						<h3>
							<a ng-href="search/?q=connectedEntities:{{entity.entityId}}">
								Verknüpfte Objekte
								<small>({{contextSize}})</small>
							</a>
						</h3>

						<div ar-facet-browser
								query="contextQuery"
								facet-name="facet_kategorie"
								context-size="contextSize">
						</div>

					</div>
				</div>

			</div>
			<!-- END CONTEXT & IMAGE SECTION -->

		</div>
			
	</div>
	
</div>
